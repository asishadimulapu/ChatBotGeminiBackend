"use strict";var Chat=require("../models/Chat"),_require=require("../gemini/geminiClient"),askGemini=_require.askGemini,validateInput=_require.validateInput;exports.createChat=function(t,r,a){var n,s,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body.prompt,s=validateInput(n),e.next=5,regeneratorRuntime.awrap(askGemini(s));case 5:return u=e.sent,e.next=8,regeneratorRuntime.awrap(Chat.create({userId:t.userId,prompt:s,response:u}));case 8:return i=e.sent,e.next=11,regeneratorRuntime.awrap(i.populate("userId","name email"));case 11:r.status(201).json(i),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(0),e.t0.message.includes("Input")||e.t0.message.includes("characters"))return e.abrupt("return",r.status(400).json({msg:e.t0.message}));e.next=18;break;case 18:a(e.t0);case 19:case"end":return e.stop()}},null,null,[[0,14]])},exports.getChats=function(t,r,a){var n,s,u,i,c,o,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=parseInt(t.query.page),s=parseInt(t.query.limit),n&&s)return u=(n-1)*s,e.next=7,regeneratorRuntime.awrap(Chat.find({userId:t.userId}).sort({createdAt:-1}).skip(u).limit(s).populate("userId","name email"));e.next=15;break;case 7:return i=e.sent,e.next=10,regeneratorRuntime.awrap(Chat.countDocuments({userId:t.userId}));case 10:c=e.sent,o=Math.ceil(c/s),r.json({chats:i,pagination:{currentPage:n,totalPages:o,totalChats:c,hasNextPage:n<o,hasPrevPage:1<n}}),e.next=19;break;case 15:return e.next=17,regeneratorRuntime.awrap(Chat.find({userId:t.userId}).sort({createdAt:-1}).limit(50).populate("userId","name email"));case 17:p=e.sent,r.json(p);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),a(e.t0);case 24:case"end":return e.stop()}},null,null,[[0,21]])},exports.deleteChat=function(t,r,a){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,regeneratorRuntime.awrap(Chat.findOneAndDelete({_id:n,userId:t.userId}));case 4:if(e.sent){e.next=7;break}return e.abrupt("return",r.status(404).json({msg:"Chat not found or unauthorized"}));case 7:r.json({msg:"Chat deleted successfully"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),a(e.t0);case 13:case"end":return e.stop()}},null,null,[[0,10]])};
//# sourceMappingURL=chatController.min.js.map
