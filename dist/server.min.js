"use strict";var express=require("express"),mongoose=require("mongoose"),cors=require("cors"),dotenv=require("dotenv"),helmet=require("helmet");dotenv.config();var _require=require("./utils/envValidator"),validateEnvironment=_require.validateEnvironment,_require2=require("./middlewares/errorHandler"),errorHandler=_require2.errorHandler,notFound=_require2.notFound,_require3=require("./middlewares/rateLimiter"),generalLimiter=_require3.generalLimiter,authRoutes=require("./routes/authRoutes"),chatRoutes=require("./routes/chatRoutes");validateEnvironment();var app=express();app.use(helmet({contentSecurityPolicy:{directives:{defaultSrc:["'self'"],styleSrc:["'self'","'unsafe-inline'"],scriptSrc:["'self'"],imgSrc:["'self'","data:","https:"]}}}));var corsOptions={origin:"production"===process.env.NODE_ENV?["https://your-frontend-domain.com"]:["http://localhost:3000","http://127.0.0.1:3000"],credentials:!0,optionsSuccessStatus:200};app.use(cors(corsOptions)),app.use(generalLimiter),app.use(express.json({limit:"10mb"})),app.use(express.urlencoded({extended:!0,limit:"10mb"})),app.use("/api/auth",authRoutes),app.use("/api/chats",chatRoutes),app.get("/health",function(e,r){r.status(200).json({status:"OK",timestamp:(new Date).toISOString(),uptime:process.uptime()})}),app.use(notFound),app.use(errorHandler);var connectDB=function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(mongoose.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}));case 3:r=e.sent,console.log("‚úÖ MongoDB Connected: ".concat(r.connection.host)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("‚ùå MongoDB connection error:",e.t0.message),process.exit(1);case 11:case"end":return e.stop()}},null,null,[[0,7]])};process.on("SIGINT",function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("\nüîÑ Shutting down gracefully..."),e.next=3,regeneratorRuntime.awrap(mongoose.connection.close());case 3:console.log("‚úÖ MongoDB connection closed"),process.exit(0);case 5:case"end":return e.stop()}})});var startServer=function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(connectDB());case 2:r=process.env.PORT||5e3,app.listen(r,function(){console.log("üöÄ Server running on port ".concat(r)),console.log("üåç Environment: ".concat(process.env.NODE_ENV||"development"))});case 4:case"end":return e.stop()}})};startServer();
//# sourceMappingURL=server.min.js.map
